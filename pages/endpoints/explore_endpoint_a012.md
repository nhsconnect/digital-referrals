---
title: "A012: Maintain Referral Letter"
keywords: endpoint, catalogue, file, referral letter, referrer clinical information
sidebar: overview_sidebar
toc: false
permalink: explore_endpoint_a012.html
summary: false
---

### API URL

Base URL (Dev3): `https://api.dev3.ers.ncrs.nhs.uk`

| Method | URL | Authentication |
| -------------| --- | ---------------- |
| POST |  [baseURL]/ReferralRequest/{UBRN}/$ers.maintainReferralLetter | Session Token [(Details)](develop_business_flow_bf001.html) |

### Description
As a Referring Clinician (/Administrator)  
I want to associate files I have uploaded to a referral
so that I can create the referral letter

This endpoint is to be used as part of the [Maintain Referral Letter](placeholder) business flow

### Prerequisite Operations
Each file to be attached to a referral needs to have been individually uploaded first by calling [A0xx: Upload file to the e-RS document store](explore_endpoint_a0xx)
A0xx will have returned to the caller the e-RS attachment ID of each uploaded file; these are the IDs that need to be passed to the Maintain Referral Letter API so that they can be associated to the referral and thus form the referral letter (which is to be considered as a "collection of files")

### Request Operation

#### Request Header

| Field Name | Value |
| ---- | ---- |
| XAPI_ASID | The "Accredited System ID" issued to the third party |
| HTTP_X_SESSION_KEY | The session key generated by the Create Session endpoint (A001)  |
| XAPI_FQDN | The "common name" of the API-specific endpoint certificate issued to the third party |
| Accept | `*/*`, `application/json+fhir` |
|Content-Type |	`application/json+fhir` |

#### Request Body
The Operation Definition for this endpoint is available on the FHIR server: [eRS-maintainReferralLetter-Operation-1](https://fhir.nhs.uk/STU3/OperationDefinition/eRS-maintainReferralLetter-Operation-1/_history/1.0)

 | Parameter Name             | Cardinality | Type            | Notes |
|  ------------------------- | --------- | --------------- | ----- |
| referralLetterFile         | 1..*        | Resource |The structure defintion of this resource is:  [eRS-DocumentReference-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-DocumentReference-1)  |

##### Example code

<details><summary>Request Header</summary>
<br>
  <pre>
    EXAMPLE CODE HERE
  </pre>
</details>

<details><summary>Request Body</summary>
<br>
  <pre>
    EXAMPLE CODE HERE
  </pre>
</details>
<br>

### Response

#### Success
HTTP Status code `200 (OK)` is returned.
The response body contains the just updated [eRS-ReferralRequest-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-ReferralRequest-1)

##### Example code
<details><summary>Response Header</summary>
<br>
  <pre>
    EXAMPLE CODE HERE
  </pre>
</details>
<details><summary>Response Body</summary>
<br>
  <pre>
    EXAMPLE CODE HERE
  </pre>
</details>
<br>

#### Failure
If an error occurs, the relating [HTTP status code](explore_error_messages.html) will be returned in the header.
Where status code 422 (Unprocessable Entity) is returned then an [eRS-OperationOutcome-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-OperationOutcome-1) will be included in the body, as detailed below.  

| issue.details.code | Description |
| ------------------ | ------ |
| CONFLICTING_VALUES |Two or more of the attachment IDs provided are the same|
|DUPLICATE_FILENAME | The names of the files that (having been previously uploaded) are being associated to the referral match the names of existing files associated with the referral, for example files uploaded during an advice and guidance conversation; or: two or more of the files uploaded via [A0xx: Upload file to e-RS document store](placeholder) have the same name  |
| INAPPROPRIATE_VALUE | In the document reference, the _type_ has  value other than 'REFERRER', or the _status_ is other than 'current' |
| INVALID_REQUEST_STATE | The UBRN relates to an onward referral; or: the referral state is either incomplete or cancelled or the referral has been superseded by an onward referral; or: the referral has an appointment booking with a date prior to today; or: the referral has an appointment booking that has been 'DNAd' ('Did Not Attend'); or: the referral already has referral letter files associated |  
| INVALID_REQUEST_TYPE | The UBRN provided exists in e-RS but does not correspond to a referral |
| INVALID_STATE | One of the attachment IDs provided relates to a file that is already linked to a referral.|  
| INVALID_VALUE | The input provided does not conform with the expected data types and format specifically documented on the FHIR OperationDefinition [eRS-maintainReferralLetter-Operation-1](https://fhir.nhs.uk/STU3/OperationDefinition/eRS-maintainReferralLetter-Operation-1/_history/1.0) or on the related FHIR profile [eRS-DocumentReference-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-DocumentReference-1)|
| NO_ACCESS | One of the attachment IDs provided relates to a file that was not uploaded by the current user |
| NO_RELATIONSHIP | The user does not have a suitable legitimate relationship with the referral |
| PATIENT_ERROR | There was an error retrieving the patient's record from SDS - this patient cannot be referred via e-RS |
| REFERENCE_NOT_FOUND | The file identified by the attachment ID does not exist in the e-RS document store |

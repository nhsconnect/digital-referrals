---
title: "A012: Maintain Referral Letter"
keywords: endpoint, catalogue, file, referral letter, referrer clinical information
sidebar: overview_sidebar
toc: false
permalink: explore_endpoint_a012.html
summary: false
---

##### Status: ![Beta](images/icons/api_beta.png)

### API URL

Base URL (Dev3): https://api.dev3.ers.ncrs.nhs.uk/ers-api/

| Method | URL | Authentication |
| -------------| --- | ---------------- |
| POST | STU3/v1/ReferralRequest/{UBRN}/$ers.maintainReferralLetter | Session Token [(Details)](develop_business_flow_bf001.html) |

### Description
As a Referring Clinician (/Administrator)  
I want to associate files I have uploaded to a referral  
So that I can create the referral letter  

### Prerequisite Operations
Each file to be attached to a referral needs to have been individually uploaded first by calling [A020: Upload file to document store](explore_endpoint_a020.html). A020 will have returned the e-RS file location of each uploaded file; these are the URLs that need to be passed to the Maintain Referral Letter API so that they can be associated to the referral and thus form the referral letter (which is to be considered as a "collection of files")

### Request Operation

#### Request Header

| Field Name | Value |
| ---- | ---- |
| XAPI_ASID | The "Accredited System ID" issued to the third party |
| HTTP_X_SESSION_KEY | The session key generated by the Create Session endpoint (A001)  |
| Accept | `application/fhir+json` |
| Content-Type |	`application/fhir+json` |

#### Request Body
The Operation Definition for this endpoint is available on the FHIR server: [eRS-maintainReferralLetter-Operation-1](https://fhir.nhs.uk/STU3/OperationDefinition/eRS-maintainReferralLetter-Operation-1/_history/1.0)

 | Parameter Name             | Cardinality | Type            | Notes |
|  ------------------------- | --------- | --------------- | ----- |
| referralLetterFile         | 1..*        | Resource |The structure definition of this resource is:  [eRS-DocumentReference-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-DocumentReference-1)  |

### Response

#### Success
HTTP Status code `200 (OK)` is returned. The response body contains the just updated [eRS-ReferralRequest-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-ReferralRequest-1)

#### Failure
If an error occurs, the relating [HTTP status code](explore_error_messages.html) will be returned in the header.
Where status code 422 (Unprocessable Entity) is returned then an [eRS-OperationOutcome-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-OperationOutcome-1) will be included in the body, as detailed below.  

| issue.details.code | Description |
| ------------------ | ------ |
| CONFLICTING_VALUES |Two or more of the attachment IDs provided are the same|
|DUPLICATE_FILENAME | The names of the files that (having been previously uploaded) are being associated to the referral match the names of existing files associated with the referral, for example files uploaded during an advice and guidance conversation; or: two or more of the files uploaded via [A020: Upload file to document store](explore_endpoint_a020.html) have the same name  |
| INAPPROPRIATE_VALUE | In the document reference, the _type_ has  value other than 'REFERRER', or the _status_ is other than 'current' |
| INVALID_REQUEST_STATE | The UBRN relates to an onward referral; or: the referral state is either incomplete or cancelled or the referral has been superseded by an onward referral; or: the referral has an appointment booking with a date prior to today; or: the referral has an appointment booking that has been 'DNAd' ('Did Not Attend'); or: the referral already has referral letter files associated |  
| INVALID_REQUEST_TYPE | The UBRN provided exists in e-RS but does not correspond to a referral |
| INVALID_STATE | One of the attachment IDs provided relates to a file that is already linked to a referral.|  
| INVALID_VALUE | The input provided does not conform with the expected data types and format specifically documented on the FHIR OperationDefinition [eRS-maintainReferralLetter-Operation-1](https://fhir.nhs.uk/STU3/OperationDefinition/eRS-maintainReferralLetter-Operation-1/_history/1.0) or on the related FHIR profile [eRS-DocumentReference-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-DocumentReference-1)|
| NO_ACCESS | One of the attachment IDs provided relates to a file that was not uploaded by the current user |
| NO_RELATIONSHIP | The user does not have a suitable legitimate relationship with the referral |
| PATIENT_ERROR | There was an error retrieving the patient's record from SDS - this patient cannot be referred via e-RS |
| REFERENCE_NOT_FOUND | The file identified by the attachment ID does not exist in the e-RS document store |

#### Examples:
##### Note: These examples contain test data, these should be replaced with appropriate values for your implementation.  

<details><summary>View request example</summary>
<br>
  <pre>
  {
    "resourceType": "Parameters",
    "meta": {
      "profile": [
        "https://fhir.nhs.uk/STU3/StructureDefinition/eRS-MaintainReferralLetter-Parameters-1"
      ]
    },
    "parameter": [
      {
        "name": "referralLetterFile",
        "resource": {
          "resourceType": "DocumentReference",
          "meta": {
            "profile": [
              "https://fhir.nhs.uk/STU3/StructureDefinition/eRS-DocumentReference-1"
            ]
          },
          "status": "current",
          "type": {
            "coding": [
              {
                "system": "https://fhir.nhs.uk/STU3/CodeSystem/eRS-AttachmentType-1",
                "code": "REFERRER",
                "display": "Referrer"
              }
            ]
          },
          "indexed": "2019-12-15T13:24:53+00:00",
          "description": "",
          "content": [
            {
              "attachment": {
                "url": "Binary/att-70045-70025"
              }
            }
          ]
        }
      },
      {
        "name": "referralLetterFile",
        "resource": {
          "resourceType": "DocumentReference",
          "meta": {
            "profile": [
              "https://fhir.nhs.uk/STU3/StructureDefinition/eRS-DocumentReference-1"
            ]
          },
          "status": "current",
          "type": {
            "coding": [
              {
                "system": "https://fhir.nhs.uk/STU3/CodeSystem/eRS-AttachmentType-1",
                "code": "REFERRER",
                "display": "Referrer"
              }
            ]
          },
          "indexed": "2019-12-15T13:24:53+00:00",
          "description": "This is a file description",
          "content": [
            {
              "attachment": {
                "url": "Binary/att-70045-70026"
              }
            }
          ]
        }
      }
    ]
  }
  </pre>
</details>
Download [request example](downloads/json/A012 Request Sample 1.json)  

<details><summary>View response example</summary>
<br>
  <pre>
  {
    "id": "000000070045",
    "meta": {
      "versionId": "6",
      "profile": [
        "https://fhir.nhs.uk/STU3/StructureDefinition/eRS-ReferralRequest-1"
      ]
    },
    "resourceType": "ReferralRequest",
    "extension": [
      {
        "url": "https://fhir.nhs.uk/STU3/StructureDefinition/Extension-eRS-ClinicalInfoFirstSubmitted-1",
        "valueDateTime": "2019-11-25T11:06:47.785Z"
      },
      {
        "url": "https://fhir.nhs.uk/STU3/StructureDefinition/Extension-eRS-ReferralPriority-1",
        "valueCodeableConcept": {
          "coding": [
            {
              "system": "https://fhir.nhs.uk/STU3/CodeSystem/eRS-Priority-1",
              "code": "ROUTINE",
              "display": "Routine"
            }
          ]
        }
      }
    ],
    "contained": [
      {
        "id": "DocumentReference-70025",
        "meta": {
          "profile": [
            "https://fhir.nhs.uk/STU3/StructureDefinition/eRS-DocumentReference-1"
          ]
        },
        "resourceType": "DocumentReference",
        "type": {
          "coding": [
            {
              "system": "https://fhir.nhs.uk/STU3/CodeSystem/eRS-AttachmentType-1",
              "code": "REFERRER",
              "display": "Referrer"
            }
          ]
        },
        "status": "current",
        "indexed": "2019-11-25T11:06:47.949Z",
        "description": "",
        "content": [
          {
            "attachment": {
              "id": "70025",
              "extension": [
                {
                  "url": "https://fhir.nhs.uk/STU3/StructureDefinition/Extension-eRS-AttachedBy-1",
                  "valueReference": {
                    "identifier": {
                      "system": "http://fhir.nhs.net/Id/sds-user-id",
                      "value": "021600556514"
                    }
                  }
                }
              ],
              "contentType": "text/plain",
              "url": "Binary/att-70045-70025",
              "size": 23,
              "title": "test.txt",
              "creation": "2019-11-25"
            }
          }
        ]
      },
      {
        "id": "DocumentReference-70026",
        "meta": {
          "profile": [
            "https://fhir.nhs.uk/STU3/StructureDefinition/eRS-DocumentReference-1"
          ]
        },
        "resourceType": "DocumentReference",
        "type": {
          "coding": [
            {
              "system": "https://fhir.nhs.uk/STU3/CodeSystem/eRS-AttachmentType-1",
              "code": "REFERRER",
              "display": "Referrer"
            }
          ]
        },
        "status": "current",
        "indexed": "2019-11-25T11:06:47.950Z",
        "description": "This is a file description",
        "content": [
          {
            "attachment": {
              "id": "70026",
              "extension": [
                {
                  "url": "https://fhir.nhs.uk/STU3/StructureDefinition/Extension-eRS-AttachedBy-1",
                  "valueReference": {
                    "identifier": {
                      "system": "http://fhir.nhs.net/Id/sds-user-id",
                      "value": "021600556514"
                    }
                  }
                }
              ],
              "contentType": "text/plain",
              "url": "Binary/att-70045-70026",
              "size": 23,
              "title": "test2.txt",
              "creation": "2019-11-25"
            }
          }
        ]
      }
    ],
    "status": "active",
    "subject": {
      "identifier": {
        "system": "http://fhir.nhs.net/Id/nhs-number",
        "value": "1470000008"
      }
    },
    "supportingInfo": [
      {
        "reference": "#DocumentReference-70025"
      },
      {
        "reference": "#DocumentReference-70026"
      }
    ],
    "intent": "plan"
  }
  </pre>
</details>
Download [response example](downloads/json/A012 Response Sample 1.json)  

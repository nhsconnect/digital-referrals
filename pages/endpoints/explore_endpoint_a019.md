---
title: "A019: Generate Patient Letter"
keywords: endpoint, catalogue, patient letter
sidebar: overview_sidebar
toc: false
permalink: explore_endpoint_a019.html
summary: false
---

### API URL

Base URL (Dev3): `https://api.dev3.ers.ncrs.nhs.uk`

| Method | URL | Authentication |
| -------------| --- | ---------------- |
| POST |  [baseURL]/ReferralRequest/[UBRN]/$ers.generatePatientLetter | Session Token [(Details)](develop_business_flow_bf001.html) |

### Description
As a Referring Clinician (/Administrator) having created a referral
I want to retrieve the patient's letter
So that the patient has all the necessary details to choose the clinic they want to attend and book an appointment

This endpoint is to be used as part of the [placeholder](placeholder) business flow

### Prerequisite Operations
A referral must exist and the user must legitimately have access to it. A letter can be re-printed multiple times, but the current API only supports the scenario of referrals that don't have an appointment booked.

### Request Operation

#### Request Header

| Field Name | Value |
| ---- | ---- |
| XAPI_ASID | The "Accredited System ID" issued to the third party |
| HTTP_X_SESSION_KEY | The session key generated by the Create Session endpoint (A001)  |
| XAPI_FQDN | The "common name" of the API-specific endpoint certificate issued to the third party |
| Accept | `*/*`, `application/pdf` |
|Content-Type |	`application/json+fhir` |

#### Request Body
This operation does not require a payload.
The operation definition for this endpoint is available on the FHIR server: [eRS-GeneratePatientLetter-Operation-1](https://fhir.nhs.uk/STU3/OperationDefinition/eRS-GeneratePatientLetter-Operation-1)

##### Example code

<details><summary>Request Header</summary>
<br>
  <pre>
    EXAMPLE CODE HERE
  </pre>
</details>

<details><summary>Request Body</summary>
<br>
  <pre>
    N/A
  </pre>
</details>
<br>

### Response

#### Success
HTTP Status code `200 (OK)` is returned.
The response body contains the binary stream of the just generated patient letter.

##### Example code
<details><summary>Response Header</summary>
<br>
  <pre>
    EXAMPLE CODE HERE
  </pre>
</details>
<details><summary>Response Body</summary>
<br>
  <pre>
    EXAMPLE BINARY STREAM
  </pre>
</details>
<br>

#### Failure
If an error occurs, the relating [HTTP status code](explore_error_messages.html) will be returned in the header.
Where status code 422 (Unprocessable Entity) is returned then an [eRS-OperationOutcome-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-OperationOutcome-1) will be included in the body, as detailed below.  

| issue.details.code | Description |
| ------------------ | ------ |
| INVALID_REQUEST_TYPE | The UBRN provided exists in e-RS but does not correspond to a referral |
| INVALID_REQUEST_STATE | The referral state is either incomplete or cancelled or the referral has a booked appointment or the referral has been superseded by an onward referral; or: the referral has a booking deferral or a triage deferral |  
| NO_ACCESS_CODE | The patient doesn't have an access code/password to log onto the patient portal |
| NO_RELATIONSHIP | The user does not have a suitable legitimate relationship with the referral |

---
title: "A019: Generate Patient Letter"
keywords: endpoint, catalogue, patient letter
sidebar: overview_sidebar
toc: false
permalink: explore_endpoint_a019.html
summary: false
---

##### Status: ![Beta](images/icons/api_beta.png)

### API URL

Base URL (Dev3): https://api.dev3.ers.ncrs.nhs.uk/ers-api/

| Method | URL | Authentication |
| -------------| --- | ---------------- |
| POST | STU3/v1/ReferralRequest/[UBRN]/$ers.generatePatientLetter | Session Token [(Details)](develop_business_flow_bf001.html) |

### Description
As a Referring Clinician (/Administrator) having created a referral  
I want to retrieve the patient's letter  
So that the patient has all the necessary details to choose the clinic they want to attend and book an appointment  

This endpoint is to be used as part of the [Create Referral](develop_business_flow_bf004.html) workflow.

### Prerequisite Operations
A referral must exist and the user must legitimately have access to it. A letter can be re-printed multiple times, but the current API only supports the scenario of referrals that don't have an appointment booked.

### Request Operation

#### Request Header

| Field Name | Value |
| ---- | ---- |
| XAPI_ASID | The "Accredited System ID" issued to the third party |
| HTTP_X_SESSION_KEY | The session key generated by the Create Session endpoint (A001)  |
| Accept | `application/pdf` |

#### Request Body
This operation does not require a body.
The operation definition for this endpoint is available on the FHIR server: [eRS-GeneratePatientLetter-Operation-1](https://fhir.nhs.uk/STU3/OperationDefinition/eRS-GeneratePatientLetter-Operation-1)

### Response

#### Success
HTTP Status code `200 (OK)` is returned.
The response body contains the binary stream of the just generated patient letter.

#### Failure
If an error occurs, the relating [HTTP status code](explore_error_messages.html) will be returned. Where status code 422 (Unprocessable Entity) is returned then an [eRS-OperationOutcome-1](https://fhir.nhs.uk/STU3/StructureDefinition/eRS-OperationOutcome-1) will be included in the body, as detailed below.  

| issue.details.code | Description |
| ------------------ | ------ |
| INVALID_REQUEST_TYPE | The UBRN provided exists in e-RS but does not correspond to a referral |
| INVALID_REQUEST_STATE | The referral is in a state that is not suitable to print the appointment request summary or the triage summary letters, for example it is either incomplete or cancelled; or the referral has a booked appointment; or the referral has been superseded by an onward referral; or: the referral has a booking deferral |  
| NO_ACCESS_CODE | The patient doesn't have an access code/password to log onto the patient portal |
| NO_RELATIONSHIP | The user does not have a suitable legitimate relationship with the referral |

#### Example:

<details><summary>Request Header</summary>
<br>
  <pre>
  XAPI_ASID:200000000220
  HTTP_X_SESSION_KEY:pro-api-session:9f0ee57a-41a6-4a6b-b50c-d50e61859c81
  Accept:*/*
  Content-Type:application/fhir+json
  </pre>
</details>

<details><summary>Response Header</summary>
<br>
  <pre>
  Connection:close
  Content-Disposition:attachment; filename="70000_Appointment_Request_Summary_20190717184948.pdf"
  Content-Length:30723
  Content-Type:application/pdf
  Date:Wed, 17 Jul 2019 17:49:48 GMT
  X_ERS_TRANSACTION_ID:00d51a3e-d462-4d48-a121-1576d9c8dab9-1
  </pre>
</details>

<details><summary>Response Body</summary>
<br>
  <pre>
 [File Data]
  </pre>
</details>
